# send one single full act like scripts/workflow_with_isaacsim.py does

from common_utils.socket_communication import (
    NonBlockingJSONSender,
    BlockingJSONReceiver,
)
import logging

logger = logging.getLogger(__name__)
main_receiver = BlockingJSONReceiver(port=9890)
main_sender = NonBlockingJSONSender(port=9891)
sender = NonBlockingJSONSender(port=9878)
receiever = BlockingJSONReceiver(port=9879)
try:
    data0 = {
        "moves": [{"type": "gripper", "grip_type": "open", "wait_time": 2.0}],
        "obstacles": [
            {
                "mass_center": [
                    0.6571512551554104,
                    0.6059089769498713,
                    0.12579120592149878,
                ],
                "std": [
                    0.018474071755971776,
                    0.017090730238941466,
                    0.051178258027157336,
                ],
            },
            {
                "mass_center": [
                    0.477011702989455,
                    0.6952136141818311,
                    0.13467713824163177,
                ],
                "std": [
                    0.017480625666332853,
                    0.019146689381400323,
                    0.04849654612869613,
                ],
            },
            {"mass_center": [0.5, -0.3, 0.1], "std": [0.09, 0.15, 0.02]},
            {"mass_center": [-0.1, 0.65, 0.2], "std": [0.1, 0.1, 0.02]},
            {"mass_center": [0.1, 0.55, 0.02], "std": [0.025, 0.1, 0.01]},
            {"mass_center": [0.6, 0.1, 0.1], "std": [0.04, 0.04, 0.02]},
        ],
    }
    data1 = {
        "moves": [
            {
                "type": "arm",
                "goal": [
                    0.38797568023204804,
                    0.4985291174054146,
                    0.11010850936174393,
                    0.36853124902409984,
                    0.43103192026780823,
                    0.5829136667418744,
                    0.5819002142365355,
                ],
                "wait_time": 0.0,
            },
            {
                "type": "arm",
                "goal": [
                    0.47179079055786133,
                    0.5309919118881226,
                    0.10550466924905777,
                    0.36853124902409984,
                    0.43103192026780823,
                    0.5829136667418744,
                    0.5819002142365355,
                ],
                "wait_time": 0.0,
            },
            {
                "type": "arm",
                "goal": [
                    0.5090419507026672,
                    0.5454198205471039,
                    0.10345851808786392,
                    0.36853124902409984,
                    0.43103192026780823,
                    0.5829136667418744,
                    0.5819002142365355,
                ],
                "wait_time": 0.0,
            },
            {"type": "gripper", "grip_type": "close", "wait_time": 1.0},
            {
                "type": "arm",
                "goal": [
                    0.014390540182283923,
                    0.6574898572246283,
                    0.4,
                    0.007536382999915103,
                    0.007932282506626975,
                    0.7249234224448524,
                    0.6887425596087086,
                ],
                "wait_time": 0.0,
            },
            {
                "type": "arm",
                "goal": [
                    0.014390540182283923,
                    0.6574898572246283,
                    0.4,
                    0.28437889350583173,
                    -0.2562418932730081,
                    0.6726259615488577,
                    0.6332796008957953,
                ],
                "wait_time": 0.0,
            },
            {
                "type": "arm",
                "goal": [
                    0.014390540182283923,
                    0.6574898572246283,
                    0.4,
                    0.5179272953765746,
                    -0.48140556364037457,
                    0.5179272953765742,
                    0.48140556364037446,
                ],
                "wait_time": 0.0,
            },
            {
                "type": "arm",
                "goal": [
                    0.014390540182283923,
                    0.6574898572246283,
                    0.4,
                    0.6726259615488579,
                    -0.6332796008957954,
                    0.28437889350583134,
                    0.25624189327300806,
                ],
                "wait_time": 1.0,
            },
            {
                "type": "arm",
                "goal": [
                    0.014390540182283923,
                    0.6574898572246283,
                    0.4,
                    0.5179272953765746,
                    -0.48140556364037457,
                    0.5179272953765742,
                    0.48140556364037446,
                ],
                "wait_time": 0.0,
            },
            {
                "type": "arm",
                "goal": [
                    0.014390540182283923,
                    0.6574898572246283,
                    0.4,
                    0.28437889350583173,
                    -0.2562418932730081,
                    0.6726259615488577,
                    0.6332796008957953,
                ],
                "wait_time": 0.0,
            },
            {
                "type": "arm",
                "goal": [
                    0.014390540182283923,
                    0.6574898572246283,
                    0.4,
                    0.007536382999915103,
                    0.007932282506626975,
                    0.7249234224448524,
                    0.6887425596087086,
                ],
                "wait_time": 0.0,
            },
            {
                "type": "arm",
                "goal": [
                    0.5090419507026672,
                    0.5454198205471039,
                    0.10845851808786393,
                    0.36853124902409984,
                    0.43103192026780823,
                    0.5829136667418744,
                    0.5819002142365355,
                ],
                "wait_time": 0.0,
            },
            {"type": "gripper", "grip_type": "open", "wait_time": 1.0},
            {
                "type": "arm",
                "goal": [
                    0.47179079055786133,
                    0.5309919118881226,
                    0.10550466924905777,
                    0.36853124902409984,
                    0.43103192026780823,
                    0.5829136667418744,
                    0.5819002142365355,
                ],
                "wait_time": 0.0,
            },
            {
                "type": "arm",
                "goal": [
                    0.38797568023204804,
                    0.4985291174054146,
                    0.11010850936174393,
                    0.36853124902409984,
                    0.43103192026780823,
                    0.5829136667418744,
                    0.5819002142365355,
                ],
                "wait_time": 0.0,
            },
        ],
        "obstacles": [
            {
                "mass_center": [
                    0.477011702989455,
                    0.6952136141818311,
                    0.13467713824163177,
                ],
                "std": [
                    0.017480625666332853,
                    0.019146689381400323,
                    0.04849654612869613,
                ],
            },
            {"mass_center": [0.5, -0.3, 0.1], "std": [0.09, 0.15, 0.02]},
            {"mass_center": [-0.1, 0.65, 0.2], "std": [0.1, 0.1, 0.02]},
            {"mass_center": [0.1, 0.55, 0.02], "std": [0.025, 0.1, 0.01]},
            {"mass_center": [0.6, 0.1, 0.1], "std": [0.04, 0.04, 0.02]},
        ],
    }
    data2 = {
        "moves": [
            {
                "type": "arm",
                "goal": [
                    0.35851441621780394,
                    0.434233016371727,
                    0.07685723006725312,
                    0.144984243515911,
                    0.14438744135379317,
                    0.6736605282814923,
                    0.710150215480446,
                ],
                "wait_time": 0.0,
            },
            {
                "type": "arm",
                "goal": [
                    0.39455166459083557,
                    0.5165769457817078,
                    0.08141730725765228,
                    0.144984243515911,
                    0.14438744135379317,
                    0.6736605282814923,
                    0.710150215480446,
                ],
                "wait_time": 0.0,
            },
            {
                "type": "arm",
                "goal": [
                    0.4105682194232941,
                    0.5531742477416992,
                    0.08344400823116302,
                    0.144984243515911,
                    0.14438744135379317,
                    0.6736605282814923,
                    0.710150215480446,
                ],
                "wait_time": 0.0,
            },
            {"type": "gripper", "grip_type": "close", "wait_time": 1.0},
            {
                "type": "arm",
                "goal": [
                    0.014390540182283923,
                    0.6574898572246283,
                    0.4,
                    0.007930447591586731,
                    0.007538313835563248,
                    0.6889190167615004,
                    0.7247557313811885,
                ],
                "wait_time": 0.0,
            },
            {
                "type": "arm",
                "goal": [
                    0.014390540182283923,
                    0.6574898572246283,
                    0.4,
                    0.2709646721693942,
                    -0.27038751704890074,
                    0.6395130300482902,
                    0.6667021984804896,
                ],
                "wait_time": 0.0,
            },
            {
                "type": "arm",
                "goal": [
                    0.014390540182283923,
                    0.6574898572246283,
                    0.4,
                    0.4927469817102813,
                    -0.5071492995316152,
                    0.49274698171028125,
                    0.5071492995316151,
                ],
                "wait_time": 0.0,
            },
            {
                "type": "arm",
                "goal": [
                    0.014390540182283923,
                    0.6574898572246283,
                    0.4,
                    0.6395130300482903,
                    -0.6667021984804897,
                    0.2709646721693941,
                    0.2703875170489006,
                ],
                "wait_time": 1.0,
            },
            {
                "type": "arm",
                "goal": [
                    0.014390540182283923,
                    0.6574898572246283,
                    0.4,
                    0.4927469817102813,
                    -0.5071492995316152,
                    0.49274698171028125,
                    0.5071492995316151,
                ],
                "wait_time": 0.0,
            },
            {
                "type": "arm",
                "goal": [
                    0.014390540182283923,
                    0.6574898572246283,
                    0.4,
                    0.2709646721693942,
                    -0.27038751704890074,
                    0.6395130300482902,
                    0.6667021984804896,
                ],
                "wait_time": 0.0,
            },
            {
                "type": "arm",
                "goal": [
                    0.014390540182283923,
                    0.6574898572246283,
                    0.4,
                    0.007930447591586731,
                    0.007538313835563248,
                    0.6889190167615004,
                    0.7247557313811885,
                ],
                "wait_time": 0.0,
            },
            {
                "type": "arm",
                "goal": [
                    0.4105682194232941,
                    0.5531742477416992,
                    0.08844400823116302,
                    0.144984243515911,
                    0.14438744135379317,
                    0.6736605282814923,
                    0.710150215480446,
                ],
                "wait_time": 0.0,
            },
            {"type": "gripper", "grip_type": "open", "wait_time": 1.0},
            {
                "type": "arm",
                "goal": [
                    0.39455166459083557,
                    0.5165769457817078,
                    0.08141730725765228,
                    0.144984243515911,
                    0.14438744135379317,
                    0.6736605282814923,
                    0.710150215480446,
                ],
                "wait_time": 0.0,
            },
            {
                "type": "arm",
                "goal": [
                    0.35851441621780394,
                    0.434233016371727,
                    0.07685723006725312,
                    0.144984243515911,
                    0.14438744135379317,
                    0.6736605282814923,
                    0.710150215480446,
                ],
                "wait_time": 0.0,
            },
        ],
        "obstacles": [
            {
                "mass_center": [
                    0.6571512551554104,
                    0.6059089769498713,
                    0.12579120592149878,
                ],
                "std": [
                    0.018474071755971776,
                    0.017090730238941466,
                    0.051178258027157336,
                ],
            },
            {"mass_center": [0.5, -0.3, 0.1], "std": [0.09, 0.15, 0.02]},
            {"mass_center": [-0.1, 0.65, 0.2], "std": [0.1, 0.1, 0.02]},
            {"mass_center": [0.1, 0.55, 0.02], "std": [0.025, 0.1, 0.01]},
            {"mass_center": [0.6, 0.1, 0.1], "std": [0.04, 0.04, 0.02]},
        ],
    }
    data3 = {
        "moves": [
            {
                "type": "arm",
                "joints_goal": [
                    0.60650192,
                    -0.74851936,
                    2.0824396,
                    2.02151015,
                    -1.55803797,
                    3.21062043,
                ],
                "wait_time": 0.0,
            }
        ],
        "obstacles": [
            {
                "mass_center": [
                    0.6571512551554104,
                    0.6059089769498713,
                    0.12579120592149878,
                ],
                "std": [
                    0.018474071755971776,
                    0.017090730238941466,
                    0.051178258027157336,
                ],
            },
            {
                "mass_center": [
                    0.477011702989455,
                    0.6952136141818311,
                    0.13467713824163177,
                ],
                "std": [
                    0.017480625666332853,
                    0.019146689381400323,
                    0.04849654612869613,
                ],
            },
            {"mass_center": [0.5, -0.3, 0.1], "std": [0.09, 0.15, 0.02]},
            {"mass_center": [-0.1, 0.65, 0.2], "std": [0.1, 0.1, 0.02]},
            {"mass_center": [0.1, 0.55, 0.02], "std": [0.025, 0.1, 0.01]},
            {"mass_center": [0.6, 0.1, 0.1], "std": [0.04, 0.04, 0.02]},
        ],
    }
    while True:
        main_data = main_receiver.capture_data()  # clear any previous data
        for data in [data0, data1, data2, data3]:
            sender.send_data(data)
            message = receiever.capture_data()
        main_sender.send_data({"done": True})
finally:
    sender.disconnect()
    receiever.disconnect()
